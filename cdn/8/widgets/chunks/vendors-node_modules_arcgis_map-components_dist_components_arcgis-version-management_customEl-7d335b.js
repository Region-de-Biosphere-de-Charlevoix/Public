"use strict";
(self["webpackChunkexb_client"] = self["webpackChunkexb_client"] || []).push([["vendors-node_modules_arcgis_map-components_dist_components_arcgis-version-management_customEl-7d335b"],{

/***/ "./node_modules/@arcgis/map-components/dist/chunks/useView.js":
/*!********************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/chunks/useView.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   V: () => (/* binding */ v),
/* harmony export */   a: () => (/* binding */ _),
/* harmony export */   u: () => (/* binding */ E)
/* harmony export */ });
/* harmony import */ var _arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @arcgis/components-controllers */ "./node_modules/@arcgis/components-controllers/dist/index.js");
/* harmony import */ var _runtime_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./runtime.js */ "./node_modules/@arcgis/map-components/dist/chunks/runtime.js");
/* harmony import */ var _arcgis_core_applications_Components_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @arcgis/core/applications/Components/reactiveUtils.js */ "@arcgis/core/applications/Components/reactiveUtils.js");
/* harmony import */ var _arcgis_core_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @arcgis/core/core/reactiveUtils.js */ "@arcgis/core/core/reactiveUtils.js");
/* harmony import */ var _component_utils_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./component-utils.js */ "./node_modules/@arcgis/map-components/dist/chunks/component-utils.js");





/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.1 */
const E = (0,_arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__.makeT9nController)(_runtime_js__WEBPACK_IMPORTED_MODULE_1__.g), _ = (s) => u(s);
class v extends _arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__.GenericController {
  constructor(e) {
    super(e), this._view$ = (0,_arcgis_core_applications_Components_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_2__.signal)(void 0), this._viewDestroyHandle = void 0, this._arcgisReadyEmitted = !1;
    const { el: t } = e, r = t.view;
    this.setProvisionalExports(void 0), Object.defineProperty(t, "view", {
      get: () => this._view$.value,
      set: (o) => {
        if (this.exports === o)
          return;
        const c = t.view;
        this._view$.value = o, this.exports = o, this.component.requestUpdate("view", c), !this._arcgisReadyEmitted && o != null && (this._arcgisReadyEmitted = !0, this.component.arcgisReady.emit());
      },
      configurable: !0,
      enumerable: !0
    }), e !== t && Object.defineProperty(e, "view", {
      get: () => t.view,
      set: (o) => {
        t.view = o;
      }
    }), queueMicrotask(() => {
      r && (t.view = r);
    });
  }
  hostConnected() {
    this._viewDestroyHandle ??= _arcgis_core_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_3__.when(
      () => this._view$.value?.destroyed,
      () => void this.component.destroy?.().catch(console.error),
      { sync: !0 }
    ), this.component.manager.loadedCalled && (0,_component_utils_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.component);
  }
  hostLoad() {
    this.component.manager.destroyed || this._watchMetaProperties();
  }
  hostLoaded() {
    const { el: e } = this.component, t = e.shadowRoot?.firstElementChild ?? e.firstElementChild ?? void 0;
    e.childElem = t ?? e.childElem, e.isConnected && (0,_component_utils_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.component);
  }
  hostDisconnected() {
    typeof this.component.el.childElem == "object" && this._view$.value?.ui?.remove(this.component.el.childElem);
  }
  hostDestroy() {
    this._viewDestroyHandle?.remove();
  }
  _watchMetaProperties() {
    (0,_arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__.watch)(this.component, "position", (e) => {
      this.component.el.childElem != null && typeof e == "string" && (0,_component_utils_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.component);
    }), (0,_arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__.watch)(this.component, "referenceElement", () => (0,_component_utils_js__WEBPACK_IMPORTED_MODULE_4__.a)(this.component));
  }
}
const u = (0,_arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__.proxyExports)(v);



/***/ }),

/***/ "./node_modules/@arcgis/map-components/dist/chunks/useViewModel.js":
/*!*************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/chunks/useViewModel.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   m: () => (/* binding */ m)
/* harmony export */ });
/* harmony import */ var _arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @arcgis/components-controllers */ "./node_modules/@arcgis/components-controllers/dist/index.js");
/* harmony import */ var _arcgis_components_controllers_accessor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @arcgis/components-controllers/accessor */ "./node_modules/@arcgis/components-controllers/dist/accessor/index.js");
/* harmony import */ var _useView_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useView.js */ "./node_modules/@arcgis/map-components/dist/chunks/useView.js");



/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.1 */
const m = (o, t) => (e, s) => l(e, o, s);
class a extends _arcgis_components_controllers_accessor__WEBPACK_IMPORTED_MODULE_1__.AccessorController {
  constructor() {
    super(...arguments), this.viewController = new _useView_js__WEBPACK_IMPORTED_MODULE_2__.V(this.component), this._viewWatchHandle = void 0;
  }
  async hostLoad() {
    await super.hostLoad(), this._viewWatchHandle = this.reactiveUtils.watch(
      () => this.component.el.view,
      (t) => {
        this._instance.view = t, this._instance.map = t?.map;
      },
      { sync: !0, initial: !0 }
    );
  }
  hostDestroy() {
    this._viewWatchHandle?.remove(), super.hostDestroy();
  }
}
const l = (0,_arcgis_components_controllers__WEBPACK_IMPORTED_MODULE_0__.proxyExports)(a);



/***/ }),

/***/ "./node_modules/@arcgis/map-components/dist/components/arcgis-version-management/customElement.js":
/*!********************************************************************************************************!*\
  !*** ./node_modules/@arcgis/map-components/dist/components/arcgis-version-management/customElement.js ***!
  \********************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ArcgisVersionManagement: () => (/* binding */ D)
/* harmony export */ });
/* harmony import */ var _chunks_runtime_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../chunks/runtime.js */ "./node_modules/@arcgis/map-components/dist/chunks/runtime.js");
/* harmony import */ var lit_html__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lit-html */ "./node_modules/lit-html/development/lit-html.js");
/* harmony import */ var _arcgis_core_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @arcgis/core/core/reactiveUtils.js */ "@arcgis/core/core/reactiveUtils.js");
/* harmony import */ var _arcgis_core_widgets_VersionManagement_VersionManagementViewModel_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @arcgis/core/widgets/VersionManagement/VersionManagementViewModel.js */ "@arcgis/core/widgets/VersionManagement/VersionManagementViewModel.js");
/* harmony import */ var _arcgis_lumina__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @arcgis/lumina */ "./node_modules/@arcgis/lumina/dist/index.js");
/* harmony import */ var lit_html_directives_ref_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! lit-html/directives/ref.js */ "./node_modules/lit-html/development/directives/ref.js");
/* harmony import */ var _chunks_useView_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../chunks/useView.js */ "./node_modules/@arcgis/map-components/dist/chunks/useView.js");
/* harmony import */ var _chunks_useViewModel_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../chunks/useViewModel.js */ "./node_modules/@arcgis/map-components/dist/chunks/useViewModel.js");
/* harmony import */ var _lit_reactive_element_css_tag_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @lit/reactive-element/css-tag.js */ "./node_modules/@lit/reactive-element/development/css-tag.js");









/*! All material copyright Esri, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.32/esri/copyright.txt for details.
v4.32.1 */
const T = (0,_lit_reactive_element_css_tag_js__WEBPACK_IMPORTED_MODULE_8__.css)`@layer{.initial-version-invalid-block{margin-bottom:1rem}.calcite-combobox-item{width:330px}.calcite-flow-widget{width:350px}calcite-block{margin:0}calcite-pagination{justify-content:center}}`, x = (0,_chunks_useViewModel_js__WEBPACK_IMPORTED_MODULE_7__.m)(_arcgis_core_widgets_VersionManagement_VersionManagementViewModel_js__WEBPACK_IMPORTED_MODULE_3__["default"]), u = "map-components:version-management";
class D extends _arcgis_lumina__WEBPACK_IMPORTED_MODULE_4__.LitElement {
  constructor() {
    super(...arguments), this.flowElement = (0,lit_html_directives_ref_js__WEBPACK_IMPORTED_MODULE_5__.createRef)(), this.messages = (0,_chunks_useView_js__WEBPACK_IMPORTED_MODULE_6__.u)({ blocking: !0 }), this.viewModel = x(this), this._isInitialVersionInvalid = /* @__PURE__ */ new Map(), this._initialVersionInfos = [], this._showInvalidFeatureServiceNotice = !1, this.allowEditingDisabled = !1, this.autoDestroyDisabled = !1, this.closable = !1, this.pageSize = 5, this.position = "top-right", this.state = this.viewModel.state, this.versioningStates = this.viewModel.versioningStates, this.view = this.viewModel.view, this.arcgisReady = (0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_4__.createEvent)(), this.arcgisVersioningStateChanged = (0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_4__.createEvent)();
  }
  static {
    this.properties = { versionList: 16, _showInvalidFeatureServiceNotice: 16, allowEditingDisabled: 5, autoDestroyDisabled: 5, closable: 7, initialVersionInfos: 0, icon: 3, label: 3, messageOverrides: 0, mode: 1, pageSize: 9, position: 1, referenceElement: 1, state: 3, versioningStates: 0, view: 0 };
  }
  static {
    this.styles = T;
  }
  static {
    this.shadowRootOptions = _arcgis_lumina__WEBPACK_IMPORTED_MODULE_4__.noShadowRoot;
  }
  get initialVersionInfos() {
    return this._initialVersionInfos;
  }
  /**
   * The `initialVersionInfos` property enables users to initialize the Version Management Component with a predefined set of versions.
   * By providing an array of `InitialVersionInfo`, the component displays a specified version for each feature service upon initialization.
   */
  set initialVersionInfos(e) {
    this._initialVersionInfos = e.map((i) => ({
      ...i,
      url: this._removeTrailingSlash(i.url)
    }));
  }
  //#endregion
  //#region Public Methods
  /** Permanently destroy the component */
  async destroy() {
    await this.manager.destroy();
  }
  //#endregion
  //#region Lifecycle
  async load() {
    (0,_arcgis_core_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_2__.once)(() => this.viewModel.state === "ready").then(() => {
      this.initialVersionInfos.forEach((e) => {
        try {
          this._changeToInitialVersion(e);
        } catch (i) {
          console.error(i);
        }
      });
    }), this.manager.onLifecycle(() => [
      (0,_arcgis_core_core_reactiveUtils_js__WEBPACK_IMPORTED_MODULE_2__.watch)(() => this.viewModel.state, (e) => {
        const { flowElement: { value: i }, versionList: t } = this, s = i?.getElementsByTagName("arcgis-version-management-version-properties")[0];
        if (e === "disabled" && i) {
          s && this._removeVersionPropertiesFlowItem(i), t && this._removeVersionListFlowItem(i);
          return;
        }
        t && (t.versionListElementProps = {
          ...t.versionListElementProps,
          executionError: this.viewModel.executionError
        }, t.versionListElementProps = {
          ...t.versionListElementProps,
          state: e
        }), s && (s.versionPropertiesElementProps = {
          ...s.versionPropertiesElementProps,
          state: e
        });
      })
    ]);
  }
  //#endregion
  //#region Private Methods
  _removeTrailingSlash(e) {
    return e.replace(/\/+$/u, "");
  }
  _createVersionPropertiesFlowItem(e, i) {
    const { closable: t, flowElement: { value: s }, viewModel: n, viewModel: { state: l } } = this, o = document.createElement("arcgis-version-management-version-properties");
    return o.versionPropertiesElementProps = {
      closable: t,
      currentUser: n.userLookup.get(e),
      hasAdvEditingUte: n.advancedEditingUserTypeExtensionLookup.get(e),
      isVersionAdministrator: n.versionAdministratorLookup.get(e),
      serviceUrl: e,
      state: l,
      strings: this.messages,
      versionInfo: i
    }, o.selected = !0, o.showBackButton = !0, o.addEventListener("arcgisCreateVersion", (r) => {
      const { createVersionParameters: d, switchToVersion: v } = r.detail;
      n.createVersion(d).then(async (a) => {
        a && this.arcgisVersioningStateChanged.emit({
          type: "version-created",
          versionIdentifier: a.versionIdentifier,
          versioningState: n.versioningStateLookup.get(e)
        }), v && await this.viewModel.changeVersion(e, a.versionIdentifier.name, a.versionIdentifier.guid).then((h) => {
          h && this.arcgisVersioningStateChanged.emit({
            type: "version-switched",
            versionIdentifier: a.versionIdentifier,
            versioningState: n.versioningStateLookup.get(e)
          });
        }), await this._refreshVersionList(e);
      }).finally(() => {
        s && this._removeVersionPropertiesFlowItem(s);
      });
    }), o.addEventListener("arcgisAlterVersion", async (r) => {
      const { flowElement: { value: d } } = this, { alterVersionParameters: v } = r.detail;
      await n.alterVersion(v).then(async (a) => {
        a && this.arcgisVersioningStateChanged.emit({
          type: "version-changed",
          versionIdentifier: v.versionIdentifier,
          versioningState: n.versioningStateLookup.get(e)
        }), await this._refreshVersionList(e);
      }).finally(() => {
        d && this._removeVersionPropertiesFlowItem(d);
      });
    }), o.addEventListener("arcgisFlowItemBack", () => {
      this._removeVersionPropertiesFlowItem(this.flowElement.value);
    }), o.addEventListener("calciteFlowItemBack", (r) => {
      r.preventDefault(), this._removeVersionPropertiesFlowItem(this.flowElement.value), this.versionList && (this.versionList.selected = !0);
    }), o.addEventListener("calciteFlowItemClose", () => {
      this._handleFlowItemClose();
    }), o;
  }
  _getLoadError(e) {
    const { messages: i } = this;
    switch (e) {
      case "no-feature-services":
        return i.loadErrors.noFeatureServices;
      case "no-view-property":
        return i.loadErrors.noViewProperty;
      default:
        return e;
    }
  }
  _changeToInitialVersion(e) {
    const { _isInitialVersionInvalid: i, viewModel: t } = this, { url: s, name: n } = e, l = t.versioningStateLookup.get(s);
    if (!l)
      throw this._showInvalidFeatureServiceNotice = !0, new Error(`${u} - no versioning state found for feature service ${s}`);
    const o = l?.versionInfos.find((v) => v.versionIdentifier.name === n);
    if (!o)
      throw i.set(s, !0), new Error(`${u} - version ${n} not found in the versioning state for feature service ${s}`);
    const r = o.versionIdentifier, d = l?.currentVersionInfo?.versionIdentifier;
    r.guid !== d?.guid && t.changeVersion(s, r.name, r.guid);
  }
  _handleFlowItemClose() {
    const e = document.querySelector("arcgis-version-management");
    e.parentElement?.removeChild(e);
  }
  async _handleNewVersionAction(e) {
    const i = this._createVersionPropertiesFlowItem(e.detail.serviceUrl, void 0);
    this.flowElement.value?.appendChild(i), this.versionList && (this.versionList.selected = !1);
  }
  async _handleManageVersionAction(e) {
    const { actionType: i, serviceUrl: t, versionInfo: s } = e.detail, { viewModel: n, flowElement: l } = this;
    switch (i) {
      case "changeVersion": {
        n.changeVersion(t, s.versionIdentifier.name, s.versionIdentifier.guid).then((o) => {
          o && this.arcgisVersioningStateChanged.emit({
            type: "version-switched",
            versionIdentifier: s.versionIdentifier,
            versioningState: n.versioningStateLookup.get(t)
          });
          const { versionList: r } = this;
          r && (r.versionListElementProps = {
            ...r.versionListElementProps,
            currentVersionIdentifier: n.versioningStateLookup.get(t).currentVersionInfo.versionIdentifier
          });
        });
        break;
      }
      case "deleteVersion": {
        n.deleteVersion(t, s.versionIdentifier.name, s.versionIdentifier.guid).then(async (o) => {
          o && this.arcgisVersioningStateChanged.emit({
            type: "version-deleted",
            versionIdentifier: s.versionIdentifier,
            versioningState: n.versioningStateLookup.get(t)
          }), await this._refreshVersionList(t);
        });
        break;
      }
      case "editVersion": {
        const o = this._createVersionPropertiesFlowItem(t, s);
        l.value?.appendChild(o), this.versionList && (this.versionList.selected = !1);
        break;
      }
    }
  }
  async _refreshVersionList(e) {
    const { flowElement: { value: i }, versionList: t, viewModel: s } = this;
    if (i) {
      const n = await s.getVersionInfos(e), l = i.getElementsByTagName("arcgis-version-management-service-item");
      for (const o of l)
        o.serviceItemElementProps.serviceUrl === e && (o.serviceItemElementProps = {
          ...o.serviceItemElementProps,
          versionInfos: n
        });
      t && (t.versionListElementProps = {
        ...t.versionListElementProps,
        currentVersionIdentifier: s.versioningStateLookup.get(e).currentVersionInfo.versionIdentifier,
        versionInfos: n
      });
    }
  }
  _removeVersionListFlowItem(e) {
    for (const i of e.childNodes)
      i.nodeName.toUpperCase() === "ARCGIS-VERSION-MANAGEMENT-VERSION-LIST" && (e.removeChild(i), this.versionList = void 0), i.nodeName.toUpperCase() === "CALCITE-FLOW-ITEM" && (i.hidden = !1);
  }
  _removeVersionPropertiesFlowItem(e) {
    for (const i of e.childNodes)
      i.nodeName.toUpperCase() === "ARCGIS-VERSION-MANAGEMENT-VERSION-PROPERTIES" && e.removeChild(i);
  }
  //#endregion
  //#region Rendering
  render() {
    const { allowEditingDisabled: e, closable: i, flowElement: { value: t }, initialVersionInfos: s, _isInitialVersionInvalid: n, label: l, messages: o, mode: r, pageSize: d, versionList: v, viewModel: a, viewModel: { loadError: h, state: m } } = this, I = Array.from(a.serviceNameLookup, ([c, f]) => ({ url: c, name: f })), V = m !== "disabled" ? I.map((c) => {
      const f = {
        allowEditing: !e,
        closable: i,
        currentUser: a.userLookup.get(c.url),
        currentVersionIdentifier: a.versioningStateLookup.get(c.url).currentVersionInfo.versionIdentifier,
        executionError: void 0,
        flowElement: t,
        hasAdvEditingUte: a.advancedEditingUserTypeExtensionLookup.get(c.url),
        heading: l,
        initialVersionInfos: s,
        isInitialVersionInvalid: n,
        isVersionAdministrator: a.versionAdministratorLookup.get(c.url),
        isVersioningApiAvailable: (a.serverVersionLookup.get(c.url) ?? 0) >= 11.2,
        mode: r,
        pageSize: d,
        serviceName: c.name,
        state: m,
        serviceUrl: c.url,
        strings: o,
        versionInfos: a.versioningStateLookup.get(c.url)?.versionInfos ?? []
      };
      return (0,lit_html__WEBPACK_IMPORTED_MODULE_1__.html)`<arcgis-version-management-service-item .serviceItemElementProps=${f} @arcgisGetVersions=${async (p) => {
        await this._refreshVersionList(p.detail.serviceUrl);
      }} @arcgisFlowItemBack=${() => {
        t && (this._removeVersionListFlowItem(t), this.versionList = void 0);
      }} @arcgisFlowItemClose=${() => {
        this._handleFlowItemClose();
      }} @arcgisManageVersion=${this._handleManageVersionAction} @arcgisNewVersion=${this._handleNewVersionAction} @arcgisCreateVersionList=${(p) => {
        this.versionList = p.detail;
      }}></arcgis-version-management-service-item>`;
    }) : void 0, E = m === "disabled" && h != null ? (0,lit_html__WEBPACK_IMPORTED_MODULE_1__.html)`<calcite-notice class="notice" kind=warning open scale=s slot=footer width=full><div slot=message>${this._getLoadError(h)}</div></calcite-notice>` : void 0, L = this._showInvalidFeatureServiceNotice ? (0,lit_html__WEBPACK_IMPORTED_MODULE_1__.html)`<calcite-notice closable kind=warning open scale=s slot=content-top width=full icon @calciteNoticeClose=${() => this._showInvalidFeatureServiceNotice = !1}><div slot=title>${o.headers.invalidInitialFeatureService}</div><div slot=message>${o.loadErrors.invalidInitialFeatureService}</div></calcite-notice>` : void 0;
    return (0,lit_html__WEBPACK_IMPORTED_MODULE_1__.html)`<calcite-flow custom-item-selectors="arcgis-version-management-version-list, arcgis-version-management-version-properties" class=${(0,_arcgis_lumina__WEBPACK_IMPORTED_MODULE_4__.safeClassMap)(this.mode === "dialog" ? "" : "calcite-flow-widget")} ${(0,lit_html_directives_ref_js__WEBPACK_IMPORTED_MODULE_5__.ref)(this.flowElement)}><calcite-flow-item .closable=${this.closable} .heading=${l ?? void 0} @calciteFlowItemClose=${() => {
      this._handleFlowItemClose();
    }} .selected=${!v}>${L}<calcite-panel .loading=${m === "loading" || m === "executing"}>${V}${E}</calcite-panel></calcite-flow-item></calcite-flow>`;
  }
}
(0,_chunks_runtime_js__WEBPACK_IMPORTED_MODULE_0__.c)("arcgis-version-management", D);



/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2lkZ2V0cy9jaHVua3MvdmVuZG9ycy1ub2RlX21vZHVsZXNfYXJjZ2lzX21hcC1jb21wb25lbnRzX2Rpc3RfY29tcG9uZW50c19hcmNnaXMtdmVyc2lvbi1tYW5hZ2VtZW50X2N1c3RvbUVsLTdkMzM1Yi5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUErSDtBQUN6RjtBQUM4QztBQUM1QjtBQUNWO0FBQzlDO0FBQ0E7QUFDQTtBQUNBLFVBQVUsaUZBQUMsQ0FBQywwQ0FBQztBQUNiLGdCQUFnQiw2RUFBQztBQUNqQjtBQUNBLDRCQUE0Qiw2RkFBQztBQUM3QixZQUFZLFFBQVE7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsZ0NBQWdDLG9FQUFNO0FBQ3RDO0FBQ0E7QUFDQSxRQUFRO0FBQ1IsOENBQThDLHNEQUFDO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLFFBQVE7QUFDcEIscURBQXFELHNEQUFDO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLHFFQUFDO0FBQ0wscUVBQXFFLHNEQUFDO0FBQ3RFLEtBQUssR0FBRyxxRUFBQywyQ0FBMkMsc0RBQUM7QUFDckQ7QUFDQTtBQUNBLFVBQVUsNEVBQUM7QUFLVDs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDL0RpRTtBQUNlO0FBQzVDO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHVGQUFDO0FBQ2pCO0FBQ0EsbURBQW1ELDBDQUFDO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSw0RUFBQztBQUdUOzs7Ozs7Ozs7Ozs7Ozs7Ozs7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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLDhDQUFDLG9FQUFvRSxHQUFHLHFCQUFxQjtBQUMxRztBQUNBLFNBQVMsc0JBQXNCO0FBQy9CO0FBQ0EsU0FBUyx1QkFBdUI7QUFDaEM7QUFDQSxTQUFTLHVCQUF1QixpQ0FBaUMsb0JBQW9CLDhCQUE4QiwyQkFBMkI7QUFDOUk7QUFDQSxRQUFRO0FBQ1IsS0FBSyxnREFBZ0QsOENBQUMscUdBQXFHLHNCQUFzQiwrRUFBK0UsOENBQUMsMkdBQTJHLGlEQUFpRCxtQkFBbUIsdUNBQXVDLDBCQUEwQiwwQ0FBMEM7QUFDM2hCLFdBQVcsOENBQUMsb0lBQW9JLDREQUFDLHVEQUF1RCxFQUFFLCtEQUFDLG1CQUFtQixnQ0FBZ0MsZUFBZSxXQUFXLGFBQWEsd0JBQXdCO0FBQzdUO0FBQ0EsT0FBTyxZQUFZLEdBQUcsR0FBRyxFQUFFLDBCQUEwQixxQ0FBcUMsR0FBRyxFQUFFLEVBQUUsRUFBRTtBQUNuRztBQUNBO0FBQ0EscURBQUM7QUFHQyIsInNvdXJjZXMiOlsid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9tYXAtY29tcG9uZW50cy9kaXN0L2NodW5rcy91c2VWaWV3LmpzIiwid2VicGFjazovL2V4Yi1jbGllbnQvLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9tYXAtY29tcG9uZW50cy9kaXN0L2NodW5rcy91c2VWaWV3TW9kZWwuanMiLCJ3ZWJwYWNrOi8vZXhiLWNsaWVudC8uL25vZGVfbW9kdWxlcy9AYXJjZ2lzL21hcC1jb21wb25lbnRzL2Rpc3QvY29tcG9uZW50cy9hcmNnaXMtdmVyc2lvbi1tYW5hZ2VtZW50L2N1c3RvbUVsZW1lbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWFrZVQ5bkNvbnRyb2xsZXIgYXMgYSwgcHJveHlFeHBvcnRzIGFzIGgsIEdlbmVyaWNDb250cm9sbGVyIGFzIGwsIHdhdGNoIGFzIG4gfSBmcm9tIFwiQGFyY2dpcy9jb21wb25lbnRzLWNvbnRyb2xsZXJzXCI7XG5pbXBvcnQgeyBnIGFzIGQgfSBmcm9tIFwiLi9ydW50aW1lLmpzXCI7XG5pbXBvcnQgeyBzaWduYWwgYXMgbSB9IGZyb20gXCJAYXJjZ2lzL2NvcmUvYXBwbGljYXRpb25zL0NvbXBvbmVudHMvcmVhY3RpdmVVdGlscy5qc1wiO1xuaW1wb3J0ICogYXMgcCBmcm9tIFwiQGFyY2dpcy9jb3JlL2NvcmUvcmVhY3RpdmVVdGlscy5qc1wiO1xuaW1wb3J0IHsgYSBhcyBpIH0gZnJvbSBcIi4vY29tcG9uZW50LXV0aWxzLmpzXCI7XG4vKiEgQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFc3JpLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cblNlZSBodHRwczovL2pzLmFyY2dpcy5jb20vNC4zMi9lc3JpL2NvcHlyaWdodC50eHQgZm9yIGRldGFpbHMuXG52NC4zMi4xICovXG5jb25zdCBFID0gYShkKSwgXyA9IChzKSA9PiB1KHMpO1xuY2xhc3MgdiBleHRlbmRzIGwge1xuICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgc3VwZXIoZSksIHRoaXMuX3ZpZXckID0gbSh2b2lkIDApLCB0aGlzLl92aWV3RGVzdHJveUhhbmRsZSA9IHZvaWQgMCwgdGhpcy5fYXJjZ2lzUmVhZHlFbWl0dGVkID0gITE7XG4gICAgY29uc3QgeyBlbDogdCB9ID0gZSwgciA9IHQudmlldztcbiAgICB0aGlzLnNldFByb3Zpc2lvbmFsRXhwb3J0cyh2b2lkIDApLCBPYmplY3QuZGVmaW5lUHJvcGVydHkodCwgXCJ2aWV3XCIsIHtcbiAgICAgIGdldDogKCkgPT4gdGhpcy5fdmlldyQudmFsdWUsXG4gICAgICBzZXQ6IChvKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmV4cG9ydHMgPT09IG8pXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCBjID0gdC52aWV3O1xuICAgICAgICB0aGlzLl92aWV3JC52YWx1ZSA9IG8sIHRoaXMuZXhwb3J0cyA9IG8sIHRoaXMuY29tcG9uZW50LnJlcXVlc3RVcGRhdGUoXCJ2aWV3XCIsIGMpLCAhdGhpcy5fYXJjZ2lzUmVhZHlFbWl0dGVkICYmIG8gIT0gbnVsbCAmJiAodGhpcy5fYXJjZ2lzUmVhZHlFbWl0dGVkID0gITAsIHRoaXMuY29tcG9uZW50LmFyY2dpc1JlYWR5LmVtaXQoKSk7XG4gICAgICB9LFxuICAgICAgY29uZmlndXJhYmxlOiAhMCxcbiAgICAgIGVudW1lcmFibGU6ICEwXG4gICAgfSksIGUgIT09IHQgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KGUsIFwidmlld1wiLCB7XG4gICAgICBnZXQ6ICgpID0+IHQudmlldyxcbiAgICAgIHNldDogKG8pID0+IHtcbiAgICAgICAgdC52aWV3ID0gbztcbiAgICAgIH1cbiAgICB9KSwgcXVldWVNaWNyb3Rhc2soKCkgPT4ge1xuICAgICAgciAmJiAodC52aWV3ID0gcik7XG4gICAgfSk7XG4gIH1cbiAgaG9zdENvbm5lY3RlZCgpIHtcbiAgICB0aGlzLl92aWV3RGVzdHJveUhhbmRsZSA/Pz0gcC53aGVuKFxuICAgICAgKCkgPT4gdGhpcy5fdmlldyQudmFsdWU/LmRlc3Ryb3llZCxcbiAgICAgICgpID0+IHZvaWQgdGhpcy5jb21wb25lbnQuZGVzdHJveT8uKCkuY2F0Y2goY29uc29sZS5lcnJvciksXG4gICAgICB7IHN5bmM6ICEwIH1cbiAgICApLCB0aGlzLmNvbXBvbmVudC5tYW5hZ2VyLmxvYWRlZENhbGxlZCAmJiBpKHRoaXMuY29tcG9uZW50KTtcbiAgfVxuICBob3N0TG9hZCgpIHtcbiAgICB0aGlzLmNvbXBvbmVudC5tYW5hZ2VyLmRlc3Ryb3llZCB8fCB0aGlzLl93YXRjaE1ldGFQcm9wZXJ0aWVzKCk7XG4gIH1cbiAgaG9zdExvYWRlZCgpIHtcbiAgICBjb25zdCB7IGVsOiBlIH0gPSB0aGlzLmNvbXBvbmVudCwgdCA9IGUuc2hhZG93Um9vdD8uZmlyc3RFbGVtZW50Q2hpbGQgPz8gZS5maXJzdEVsZW1lbnRDaGlsZCA/PyB2b2lkIDA7XG4gICAgZS5jaGlsZEVsZW0gPSB0ID8/IGUuY2hpbGRFbGVtLCBlLmlzQ29ubmVjdGVkICYmIGkodGhpcy5jb21wb25lbnQpO1xuICB9XG4gIGhvc3REaXNjb25uZWN0ZWQoKSB7XG4gICAgdHlwZW9mIHRoaXMuY29tcG9uZW50LmVsLmNoaWxkRWxlbSA9PSBcIm9iamVjdFwiICYmIHRoaXMuX3ZpZXckLnZhbHVlPy51aT8ucmVtb3ZlKHRoaXMuY29tcG9uZW50LmVsLmNoaWxkRWxlbSk7XG4gIH1cbiAgaG9zdERlc3Ryb3koKSB7XG4gICAgdGhpcy5fdmlld0Rlc3Ryb3lIYW5kbGU/LnJlbW92ZSgpO1xuICB9XG4gIF93YXRjaE1ldGFQcm9wZXJ0aWVzKCkge1xuICAgIG4odGhpcy5jb21wb25lbnQsIFwicG9zaXRpb25cIiwgKGUpID0+IHtcbiAgICAgIHRoaXMuY29tcG9uZW50LmVsLmNoaWxkRWxlbSAhPSBudWxsICYmIHR5cGVvZiBlID09IFwic3RyaW5nXCIgJiYgaSh0aGlzLmNvbXBvbmVudCk7XG4gICAgfSksIG4odGhpcy5jb21wb25lbnQsIFwicmVmZXJlbmNlRWxlbWVudFwiLCAoKSA9PiBpKHRoaXMuY29tcG9uZW50KSk7XG4gIH1cbn1cbmNvbnN0IHUgPSBoKHYpO1xuZXhwb3J0IHtcbiAgdiBhcyBWLFxuICBfIGFzIGEsXG4gIEUgYXMgdVxufTtcbiIsImltcG9ydCB7IHByb3h5RXhwb3J0cyBhcyByIH0gZnJvbSBcIkBhcmNnaXMvY29tcG9uZW50cy1jb250cm9sbGVyc1wiO1xuaW1wb3J0IHsgQWNjZXNzb3JDb250cm9sbGVyIGFzIGkgfSBmcm9tIFwiQGFyY2dpcy9jb21wb25lbnRzLWNvbnRyb2xsZXJzL2FjY2Vzc29yXCI7XG5pbXBvcnQgeyBWIGFzIG4gfSBmcm9tIFwiLi91c2VWaWV3LmpzXCI7XG4vKiEgQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFc3JpLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cblNlZSBodHRwczovL2pzLmFyY2dpcy5jb20vNC4zMi9lc3JpL2NvcHlyaWdodC50eHQgZm9yIGRldGFpbHMuXG52NC4zMi4xICovXG5jb25zdCBtID0gKG8sIHQpID0+IChlLCBzKSA9PiBsKGUsIG8sIHMpO1xuY2xhc3MgYSBleHRlbmRzIGkge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlciguLi5hcmd1bWVudHMpLCB0aGlzLnZpZXdDb250cm9sbGVyID0gbmV3IG4odGhpcy5jb21wb25lbnQpLCB0aGlzLl92aWV3V2F0Y2hIYW5kbGUgPSB2b2lkIDA7XG4gIH1cbiAgYXN5bmMgaG9zdExvYWQoKSB7XG4gICAgYXdhaXQgc3VwZXIuaG9zdExvYWQoKSwgdGhpcy5fdmlld1dhdGNoSGFuZGxlID0gdGhpcy5yZWFjdGl2ZVV0aWxzLndhdGNoKFxuICAgICAgKCkgPT4gdGhpcy5jb21wb25lbnQuZWwudmlldyxcbiAgICAgICh0KSA9PiB7XG4gICAgICAgIHRoaXMuX2luc3RhbmNlLnZpZXcgPSB0LCB0aGlzLl9pbnN0YW5jZS5tYXAgPSB0Py5tYXA7XG4gICAgICB9LFxuICAgICAgeyBzeW5jOiAhMCwgaW5pdGlhbDogITAgfVxuICAgICk7XG4gIH1cbiAgaG9zdERlc3Ryb3koKSB7XG4gICAgdGhpcy5fdmlld1dhdGNoSGFuZGxlPy5yZW1vdmUoKSwgc3VwZXIuaG9zdERlc3Ryb3koKTtcbiAgfVxufVxuY29uc3QgbCA9IHIoYSk7XG5leHBvcnQge1xuICBtXG59O1xuIiwiaW1wb3J0IHsgYyBhcyBTIH0gZnJvbSBcIi4uLy4uL2NodW5rcy9ydW50aW1lLmpzXCI7XG5pbXBvcnQgeyBodG1sIGFzIGcgfSBmcm9tIFwibGl0LWh0bWxcIjtcbmltcG9ydCB7IG9uY2UgYXMgXywgd2F0Y2ggYXMgeSB9IGZyb20gXCJAYXJjZ2lzL2NvcmUvY29yZS9yZWFjdGl2ZVV0aWxzLmpzXCI7XG5pbXBvcnQgUCBmcm9tIFwiQGFyY2dpcy9jb3JlL3dpZGdldHMvVmVyc2lvbk1hbmFnZW1lbnQvVmVyc2lvbk1hbmFnZW1lbnRWaWV3TW9kZWwuanNcIjtcbmltcG9ydCB7IExpdEVsZW1lbnQgYXMgRiwgY3JlYXRlRXZlbnQgYXMgdywgbm9TaGFkb3dSb290IGFzIE0sIHNhZmVDbGFzc01hcCBhcyBOIH0gZnJvbSBcIkBhcmNnaXMvbHVtaW5hXCI7XG5pbXBvcnQgeyBjcmVhdGVSZWYgYXMgaywgcmVmIGFzIEMgfSBmcm9tIFwibGl0LWh0bWwvZGlyZWN0aXZlcy9yZWYuanNcIjtcbmltcG9ydCB7IHUgYXMgYiB9IGZyb20gXCIuLi8uLi9jaHVua3MvdXNlVmlldy5qc1wiO1xuaW1wb3J0IHsgbSBhcyAkIH0gZnJvbSBcIi4uLy4uL2NodW5rcy91c2VWaWV3TW9kZWwuanNcIjtcbmltcG9ydCB7IGNzcyBhcyBBIH0gZnJvbSBcIkBsaXQvcmVhY3RpdmUtZWxlbWVudC9jc3MtdGFnLmpzXCI7XG4vKiEgQWxsIG1hdGVyaWFsIGNvcHlyaWdodCBFc3JpLCBBbGwgUmlnaHRzIFJlc2VydmVkLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cblNlZSBodHRwczovL2pzLmFyY2dpcy5jb20vNC4zMi9lc3JpL2NvcHlyaWdodC50eHQgZm9yIGRldGFpbHMuXG52NC4zMi4xICovXG5jb25zdCBUID0gQWBAbGF5ZXJ7LmluaXRpYWwtdmVyc2lvbi1pbnZhbGlkLWJsb2Nre21hcmdpbi1ib3R0b206MXJlbX0uY2FsY2l0ZS1jb21ib2JveC1pdGVte3dpZHRoOjMzMHB4fS5jYWxjaXRlLWZsb3ctd2lkZ2V0e3dpZHRoOjM1MHB4fWNhbGNpdGUtYmxvY2t7bWFyZ2luOjB9Y2FsY2l0ZS1wYWdpbmF0aW9ue2p1c3RpZnktY29udGVudDpjZW50ZXJ9fWAsIHggPSAkKFApLCB1ID0gXCJtYXAtY29tcG9uZW50czp2ZXJzaW9uLW1hbmFnZW1lbnRcIjtcbmNsYXNzIEQgZXh0ZW5kcyBGIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoLi4uYXJndW1lbnRzKSwgdGhpcy5mbG93RWxlbWVudCA9IGsoKSwgdGhpcy5tZXNzYWdlcyA9IGIoeyBibG9ja2luZzogITAgfSksIHRoaXMudmlld01vZGVsID0geCh0aGlzKSwgdGhpcy5faXNJbml0aWFsVmVyc2lvbkludmFsaWQgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpLCB0aGlzLl9pbml0aWFsVmVyc2lvbkluZm9zID0gW10sIHRoaXMuX3Nob3dJbnZhbGlkRmVhdHVyZVNlcnZpY2VOb3RpY2UgPSAhMSwgdGhpcy5hbGxvd0VkaXRpbmdEaXNhYmxlZCA9ICExLCB0aGlzLmF1dG9EZXN0cm95RGlzYWJsZWQgPSAhMSwgdGhpcy5jbG9zYWJsZSA9ICExLCB0aGlzLnBhZ2VTaXplID0gNSwgdGhpcy5wb3NpdGlvbiA9IFwidG9wLXJpZ2h0XCIsIHRoaXMuc3RhdGUgPSB0aGlzLnZpZXdNb2RlbC5zdGF0ZSwgdGhpcy52ZXJzaW9uaW5nU3RhdGVzID0gdGhpcy52aWV3TW9kZWwudmVyc2lvbmluZ1N0YXRlcywgdGhpcy52aWV3ID0gdGhpcy52aWV3TW9kZWwudmlldywgdGhpcy5hcmNnaXNSZWFkeSA9IHcoKSwgdGhpcy5hcmNnaXNWZXJzaW9uaW5nU3RhdGVDaGFuZ2VkID0gdygpO1xuICB9XG4gIHN0YXRpYyB7XG4gICAgdGhpcy5wcm9wZXJ0aWVzID0geyB2ZXJzaW9uTGlzdDogMTYsIF9zaG93SW52YWxpZEZlYXR1cmVTZXJ2aWNlTm90aWNlOiAxNiwgYWxsb3dFZGl0aW5nRGlzYWJsZWQ6IDUsIGF1dG9EZXN0cm95RGlzYWJsZWQ6IDUsIGNsb3NhYmxlOiA3LCBpbml0aWFsVmVyc2lvbkluZm9zOiAwLCBpY29uOiAzLCBsYWJlbDogMywgbWVzc2FnZU92ZXJyaWRlczogMCwgbW9kZTogMSwgcGFnZVNpemU6IDksIHBvc2l0aW9uOiAxLCByZWZlcmVuY2VFbGVtZW50OiAxLCBzdGF0ZTogMywgdmVyc2lvbmluZ1N0YXRlczogMCwgdmlldzogMCB9O1xuICB9XG4gIHN0YXRpYyB7XG4gICAgdGhpcy5zdHlsZXMgPSBUO1xuICB9XG4gIHN0YXRpYyB7XG4gICAgdGhpcy5zaGFkb3dSb290T3B0aW9ucyA9IE07XG4gIH1cbiAgZ2V0IGluaXRpYWxWZXJzaW9uSW5mb3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2luaXRpYWxWZXJzaW9uSW5mb3M7XG4gIH1cbiAgLyoqXG4gICAqIFRoZSBgaW5pdGlhbFZlcnNpb25JbmZvc2AgcHJvcGVydHkgZW5hYmxlcyB1c2VycyB0byBpbml0aWFsaXplIHRoZSBWZXJzaW9uIE1hbmFnZW1lbnQgQ29tcG9uZW50IHdpdGggYSBwcmVkZWZpbmVkIHNldCBvZiB2ZXJzaW9ucy5cbiAgICogQnkgcHJvdmlkaW5nIGFuIGFycmF5IG9mIGBJbml0aWFsVmVyc2lvbkluZm9gLCB0aGUgY29tcG9uZW50IGRpc3BsYXlzIGEgc3BlY2lmaWVkIHZlcnNpb24gZm9yIGVhY2ggZmVhdHVyZSBzZXJ2aWNlIHVwb24gaW5pdGlhbGl6YXRpb24uXG4gICAqL1xuICBzZXQgaW5pdGlhbFZlcnNpb25JbmZvcyhlKSB7XG4gICAgdGhpcy5faW5pdGlhbFZlcnNpb25JbmZvcyA9IGUubWFwKChpKSA9PiAoe1xuICAgICAgLi4uaSxcbiAgICAgIHVybDogdGhpcy5fcmVtb3ZlVHJhaWxpbmdTbGFzaChpLnVybClcbiAgICB9KSk7XG4gIH1cbiAgLy8jZW5kcmVnaW9uXG4gIC8vI3JlZ2lvbiBQdWJsaWMgTWV0aG9kc1xuICAvKiogUGVybWFuZW50bHkgZGVzdHJveSB0aGUgY29tcG9uZW50ICovXG4gIGFzeW5jIGRlc3Ryb3koKSB7XG4gICAgYXdhaXQgdGhpcy5tYW5hZ2VyLmRlc3Ryb3koKTtcbiAgfVxuICAvLyNlbmRyZWdpb25cbiAgLy8jcmVnaW9uIExpZmVjeWNsZVxuICBhc3luYyBsb2FkKCkge1xuICAgIF8oKCkgPT4gdGhpcy52aWV3TW9kZWwuc3RhdGUgPT09IFwicmVhZHlcIikudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmluaXRpYWxWZXJzaW9uSW5mb3MuZm9yRWFjaCgoZSkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHRoaXMuX2NoYW5nZVRvSW5pdGlhbFZlcnNpb24oZSk7XG4gICAgICAgIH0gY2F0Y2ggKGkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KSwgdGhpcy5tYW5hZ2VyLm9uTGlmZWN5Y2xlKCgpID0+IFtcbiAgICAgIHkoKCkgPT4gdGhpcy52aWV3TW9kZWwuc3RhdGUsIChlKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZmxvd0VsZW1lbnQ6IHsgdmFsdWU6IGkgfSwgdmVyc2lvbkxpc3Q6IHQgfSA9IHRoaXMsIHMgPSBpPy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImFyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnQtdmVyc2lvbi1wcm9wZXJ0aWVzXCIpWzBdO1xuICAgICAgICBpZiAoZSA9PT0gXCJkaXNhYmxlZFwiICYmIGkpIHtcbiAgICAgICAgICBzICYmIHRoaXMuX3JlbW92ZVZlcnNpb25Qcm9wZXJ0aWVzRmxvd0l0ZW0oaSksIHQgJiYgdGhpcy5fcmVtb3ZlVmVyc2lvbkxpc3RGbG93SXRlbShpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdCAmJiAodC52ZXJzaW9uTGlzdEVsZW1lbnRQcm9wcyA9IHtcbiAgICAgICAgICAuLi50LnZlcnNpb25MaXN0RWxlbWVudFByb3BzLFxuICAgICAgICAgIGV4ZWN1dGlvbkVycm9yOiB0aGlzLnZpZXdNb2RlbC5leGVjdXRpb25FcnJvclxuICAgICAgICB9LCB0LnZlcnNpb25MaXN0RWxlbWVudFByb3BzID0ge1xuICAgICAgICAgIC4uLnQudmVyc2lvbkxpc3RFbGVtZW50UHJvcHMsXG4gICAgICAgICAgc3RhdGU6IGVcbiAgICAgICAgfSksIHMgJiYgKHMudmVyc2lvblByb3BlcnRpZXNFbGVtZW50UHJvcHMgPSB7XG4gICAgICAgICAgLi4ucy52ZXJzaW9uUHJvcGVydGllc0VsZW1lbnRQcm9wcyxcbiAgICAgICAgICBzdGF0ZTogZVxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgXSk7XG4gIH1cbiAgLy8jZW5kcmVnaW9uXG4gIC8vI3JlZ2lvbiBQcml2YXRlIE1ldGhvZHNcbiAgX3JlbW92ZVRyYWlsaW5nU2xhc2goZSkge1xuICAgIHJldHVybiBlLnJlcGxhY2UoL1xcLyskL3UsIFwiXCIpO1xuICB9XG4gIF9jcmVhdGVWZXJzaW9uUHJvcGVydGllc0Zsb3dJdGVtKGUsIGkpIHtcbiAgICBjb25zdCB7IGNsb3NhYmxlOiB0LCBmbG93RWxlbWVudDogeyB2YWx1ZTogcyB9LCB2aWV3TW9kZWw6IG4sIHZpZXdNb2RlbDogeyBzdGF0ZTogbCB9IH0gPSB0aGlzLCBvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnQtdmVyc2lvbi1wcm9wZXJ0aWVzXCIpO1xuICAgIHJldHVybiBvLnZlcnNpb25Qcm9wZXJ0aWVzRWxlbWVudFByb3BzID0ge1xuICAgICAgY2xvc2FibGU6IHQsXG4gICAgICBjdXJyZW50VXNlcjogbi51c2VyTG9va3VwLmdldChlKSxcbiAgICAgIGhhc0FkdkVkaXRpbmdVdGU6IG4uYWR2YW5jZWRFZGl0aW5nVXNlclR5cGVFeHRlbnNpb25Mb29rdXAuZ2V0KGUpLFxuICAgICAgaXNWZXJzaW9uQWRtaW5pc3RyYXRvcjogbi52ZXJzaW9uQWRtaW5pc3RyYXRvckxvb2t1cC5nZXQoZSksXG4gICAgICBzZXJ2aWNlVXJsOiBlLFxuICAgICAgc3RhdGU6IGwsXG4gICAgICBzdHJpbmdzOiB0aGlzLm1lc3NhZ2VzLFxuICAgICAgdmVyc2lvbkluZm86IGlcbiAgICB9LCBvLnNlbGVjdGVkID0gITAsIG8uc2hvd0JhY2tCdXR0b24gPSAhMCwgby5hZGRFdmVudExpc3RlbmVyKFwiYXJjZ2lzQ3JlYXRlVmVyc2lvblwiLCAocikgPT4ge1xuICAgICAgY29uc3QgeyBjcmVhdGVWZXJzaW9uUGFyYW1ldGVyczogZCwgc3dpdGNoVG9WZXJzaW9uOiB2IH0gPSByLmRldGFpbDtcbiAgICAgIG4uY3JlYXRlVmVyc2lvbihkKS50aGVuKGFzeW5jIChhKSA9PiB7XG4gICAgICAgIGEgJiYgdGhpcy5hcmNnaXNWZXJzaW9uaW5nU3RhdGVDaGFuZ2VkLmVtaXQoe1xuICAgICAgICAgIHR5cGU6IFwidmVyc2lvbi1jcmVhdGVkXCIsXG4gICAgICAgICAgdmVyc2lvbklkZW50aWZpZXI6IGEudmVyc2lvbklkZW50aWZpZXIsXG4gICAgICAgICAgdmVyc2lvbmluZ1N0YXRlOiBuLnZlcnNpb25pbmdTdGF0ZUxvb2t1cC5nZXQoZSlcbiAgICAgICAgfSksIHYgJiYgYXdhaXQgdGhpcy52aWV3TW9kZWwuY2hhbmdlVmVyc2lvbihlLCBhLnZlcnNpb25JZGVudGlmaWVyLm5hbWUsIGEudmVyc2lvbklkZW50aWZpZXIuZ3VpZCkudGhlbigoaCkgPT4ge1xuICAgICAgICAgIGggJiYgdGhpcy5hcmNnaXNWZXJzaW9uaW5nU3RhdGVDaGFuZ2VkLmVtaXQoe1xuICAgICAgICAgICAgdHlwZTogXCJ2ZXJzaW9uLXN3aXRjaGVkXCIsXG4gICAgICAgICAgICB2ZXJzaW9uSWRlbnRpZmllcjogYS52ZXJzaW9uSWRlbnRpZmllcixcbiAgICAgICAgICAgIHZlcnNpb25pbmdTdGF0ZTogbi52ZXJzaW9uaW5nU3RhdGVMb29rdXAuZ2V0KGUpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pLCBhd2FpdCB0aGlzLl9yZWZyZXNoVmVyc2lvbkxpc3QoZSk7XG4gICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgcyAmJiB0aGlzLl9yZW1vdmVWZXJzaW9uUHJvcGVydGllc0Zsb3dJdGVtKHMpO1xuICAgICAgfSk7XG4gICAgfSksIG8uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc0FsdGVyVmVyc2lvblwiLCBhc3luYyAocikgPT4ge1xuICAgICAgY29uc3QgeyBmbG93RWxlbWVudDogeyB2YWx1ZTogZCB9IH0gPSB0aGlzLCB7IGFsdGVyVmVyc2lvblBhcmFtZXRlcnM6IHYgfSA9IHIuZGV0YWlsO1xuICAgICAgYXdhaXQgbi5hbHRlclZlcnNpb24odikudGhlbihhc3luYyAoYSkgPT4ge1xuICAgICAgICBhICYmIHRoaXMuYXJjZ2lzVmVyc2lvbmluZ1N0YXRlQ2hhbmdlZC5lbWl0KHtcbiAgICAgICAgICB0eXBlOiBcInZlcnNpb24tY2hhbmdlZFwiLFxuICAgICAgICAgIHZlcnNpb25JZGVudGlmaWVyOiB2LnZlcnNpb25JZGVudGlmaWVyLFxuICAgICAgICAgIHZlcnNpb25pbmdTdGF0ZTogbi52ZXJzaW9uaW5nU3RhdGVMb29rdXAuZ2V0KGUpXG4gICAgICAgIH0pLCBhd2FpdCB0aGlzLl9yZWZyZXNoVmVyc2lvbkxpc3QoZSk7XG4gICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgZCAmJiB0aGlzLl9yZW1vdmVWZXJzaW9uUHJvcGVydGllc0Zsb3dJdGVtKGQpO1xuICAgICAgfSk7XG4gICAgfSksIG8uYWRkRXZlbnRMaXN0ZW5lcihcImFyY2dpc0Zsb3dJdGVtQmFja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9yZW1vdmVWZXJzaW9uUHJvcGVydGllc0Zsb3dJdGVtKHRoaXMuZmxvd0VsZW1lbnQudmFsdWUpO1xuICAgIH0pLCBvLmFkZEV2ZW50TGlzdGVuZXIoXCJjYWxjaXRlRmxvd0l0ZW1CYWNrXCIsIChyKSA9PiB7XG4gICAgICByLnByZXZlbnREZWZhdWx0KCksIHRoaXMuX3JlbW92ZVZlcnNpb25Qcm9wZXJ0aWVzRmxvd0l0ZW0odGhpcy5mbG93RWxlbWVudC52YWx1ZSksIHRoaXMudmVyc2lvbkxpc3QgJiYgKHRoaXMudmVyc2lvbkxpc3Quc2VsZWN0ZWQgPSAhMCk7XG4gICAgfSksIG8uYWRkRXZlbnRMaXN0ZW5lcihcImNhbGNpdGVGbG93SXRlbUNsb3NlXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUZsb3dJdGVtQ2xvc2UoKTtcbiAgICB9KSwgbztcbiAgfVxuICBfZ2V0TG9hZEVycm9yKGUpIHtcbiAgICBjb25zdCB7IG1lc3NhZ2VzOiBpIH0gPSB0aGlzO1xuICAgIHN3aXRjaCAoZSkge1xuICAgICAgY2FzZSBcIm5vLWZlYXR1cmUtc2VydmljZXNcIjpcbiAgICAgICAgcmV0dXJuIGkubG9hZEVycm9ycy5ub0ZlYXR1cmVTZXJ2aWNlcztcbiAgICAgIGNhc2UgXCJuby12aWV3LXByb3BlcnR5XCI6XG4gICAgICAgIHJldHVybiBpLmxvYWRFcnJvcnMubm9WaWV3UHJvcGVydHk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gIH1cbiAgX2NoYW5nZVRvSW5pdGlhbFZlcnNpb24oZSkge1xuICAgIGNvbnN0IHsgX2lzSW5pdGlhbFZlcnNpb25JbnZhbGlkOiBpLCB2aWV3TW9kZWw6IHQgfSA9IHRoaXMsIHsgdXJsOiBzLCBuYW1lOiBuIH0gPSBlLCBsID0gdC52ZXJzaW9uaW5nU3RhdGVMb29rdXAuZ2V0KHMpO1xuICAgIGlmICghbClcbiAgICAgIHRocm93IHRoaXMuX3Nob3dJbnZhbGlkRmVhdHVyZVNlcnZpY2VOb3RpY2UgPSAhMCwgbmV3IEVycm9yKGAke3V9IC0gbm8gdmVyc2lvbmluZyBzdGF0ZSBmb3VuZCBmb3IgZmVhdHVyZSBzZXJ2aWNlICR7c31gKTtcbiAgICBjb25zdCBvID0gbD8udmVyc2lvbkluZm9zLmZpbmQoKHYpID0+IHYudmVyc2lvbklkZW50aWZpZXIubmFtZSA9PT0gbik7XG4gICAgaWYgKCFvKVxuICAgICAgdGhyb3cgaS5zZXQocywgITApLCBuZXcgRXJyb3IoYCR7dX0gLSB2ZXJzaW9uICR7bn0gbm90IGZvdW5kIGluIHRoZSB2ZXJzaW9uaW5nIHN0YXRlIGZvciBmZWF0dXJlIHNlcnZpY2UgJHtzfWApO1xuICAgIGNvbnN0IHIgPSBvLnZlcnNpb25JZGVudGlmaWVyLCBkID0gbD8uY3VycmVudFZlcnNpb25JbmZvPy52ZXJzaW9uSWRlbnRpZmllcjtcbiAgICByLmd1aWQgIT09IGQ/Lmd1aWQgJiYgdC5jaGFuZ2VWZXJzaW9uKHMsIHIubmFtZSwgci5ndWlkKTtcbiAgfVxuICBfaGFuZGxlRmxvd0l0ZW1DbG9zZSgpIHtcbiAgICBjb25zdCBlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImFyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnRcIik7XG4gICAgZS5wYXJlbnRFbGVtZW50Py5yZW1vdmVDaGlsZChlKTtcbiAgfVxuICBhc3luYyBfaGFuZGxlTmV3VmVyc2lvbkFjdGlvbihlKSB7XG4gICAgY29uc3QgaSA9IHRoaXMuX2NyZWF0ZVZlcnNpb25Qcm9wZXJ0aWVzRmxvd0l0ZW0oZS5kZXRhaWwuc2VydmljZVVybCwgdm9pZCAwKTtcbiAgICB0aGlzLmZsb3dFbGVtZW50LnZhbHVlPy5hcHBlbmRDaGlsZChpKSwgdGhpcy52ZXJzaW9uTGlzdCAmJiAodGhpcy52ZXJzaW9uTGlzdC5zZWxlY3RlZCA9ICExKTtcbiAgfVxuICBhc3luYyBfaGFuZGxlTWFuYWdlVmVyc2lvbkFjdGlvbihlKSB7XG4gICAgY29uc3QgeyBhY3Rpb25UeXBlOiBpLCBzZXJ2aWNlVXJsOiB0LCB2ZXJzaW9uSW5mbzogcyB9ID0gZS5kZXRhaWwsIHsgdmlld01vZGVsOiBuLCBmbG93RWxlbWVudDogbCB9ID0gdGhpcztcbiAgICBzd2l0Y2ggKGkpIHtcbiAgICAgIGNhc2UgXCJjaGFuZ2VWZXJzaW9uXCI6IHtcbiAgICAgICAgbi5jaGFuZ2VWZXJzaW9uKHQsIHMudmVyc2lvbklkZW50aWZpZXIubmFtZSwgcy52ZXJzaW9uSWRlbnRpZmllci5ndWlkKS50aGVuKChvKSA9PiB7XG4gICAgICAgICAgbyAmJiB0aGlzLmFyY2dpc1ZlcnNpb25pbmdTdGF0ZUNoYW5nZWQuZW1pdCh7XG4gICAgICAgICAgICB0eXBlOiBcInZlcnNpb24tc3dpdGNoZWRcIixcbiAgICAgICAgICAgIHZlcnNpb25JZGVudGlmaWVyOiBzLnZlcnNpb25JZGVudGlmaWVyLFxuICAgICAgICAgICAgdmVyc2lvbmluZ1N0YXRlOiBuLnZlcnNpb25pbmdTdGF0ZUxvb2t1cC5nZXQodClcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBjb25zdCB7IHZlcnNpb25MaXN0OiByIH0gPSB0aGlzO1xuICAgICAgICAgIHIgJiYgKHIudmVyc2lvbkxpc3RFbGVtZW50UHJvcHMgPSB7XG4gICAgICAgICAgICAuLi5yLnZlcnNpb25MaXN0RWxlbWVudFByb3BzLFxuICAgICAgICAgICAgY3VycmVudFZlcnNpb25JZGVudGlmaWVyOiBuLnZlcnNpb25pbmdTdGF0ZUxvb2t1cC5nZXQodCkuY3VycmVudFZlcnNpb25JbmZvLnZlcnNpb25JZGVudGlmaWVyXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJkZWxldGVWZXJzaW9uXCI6IHtcbiAgICAgICAgbi5kZWxldGVWZXJzaW9uKHQsIHMudmVyc2lvbklkZW50aWZpZXIubmFtZSwgcy52ZXJzaW9uSWRlbnRpZmllci5ndWlkKS50aGVuKGFzeW5jIChvKSA9PiB7XG4gICAgICAgICAgbyAmJiB0aGlzLmFyY2dpc1ZlcnNpb25pbmdTdGF0ZUNoYW5nZWQuZW1pdCh7XG4gICAgICAgICAgICB0eXBlOiBcInZlcnNpb24tZGVsZXRlZFwiLFxuICAgICAgICAgICAgdmVyc2lvbklkZW50aWZpZXI6IHMudmVyc2lvbklkZW50aWZpZXIsXG4gICAgICAgICAgICB2ZXJzaW9uaW5nU3RhdGU6IG4udmVyc2lvbmluZ1N0YXRlTG9va3VwLmdldCh0KVxuICAgICAgICAgIH0pLCBhd2FpdCB0aGlzLl9yZWZyZXNoVmVyc2lvbkxpc3QodCk7XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgXCJlZGl0VmVyc2lvblwiOiB7XG4gICAgICAgIGNvbnN0IG8gPSB0aGlzLl9jcmVhdGVWZXJzaW9uUHJvcGVydGllc0Zsb3dJdGVtKHQsIHMpO1xuICAgICAgICBsLnZhbHVlPy5hcHBlbmRDaGlsZChvKSwgdGhpcy52ZXJzaW9uTGlzdCAmJiAodGhpcy52ZXJzaW9uTGlzdC5zZWxlY3RlZCA9ICExKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGFzeW5jIF9yZWZyZXNoVmVyc2lvbkxpc3QoZSkge1xuICAgIGNvbnN0IHsgZmxvd0VsZW1lbnQ6IHsgdmFsdWU6IGkgfSwgdmVyc2lvbkxpc3Q6IHQsIHZpZXdNb2RlbDogcyB9ID0gdGhpcztcbiAgICBpZiAoaSkge1xuICAgICAgY29uc3QgbiA9IGF3YWl0IHMuZ2V0VmVyc2lvbkluZm9zKGUpLCBsID0gaS5nZXRFbGVtZW50c0J5VGFnTmFtZShcImFyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnQtc2VydmljZS1pdGVtXCIpO1xuICAgICAgZm9yIChjb25zdCBvIG9mIGwpXG4gICAgICAgIG8uc2VydmljZUl0ZW1FbGVtZW50UHJvcHMuc2VydmljZVVybCA9PT0gZSAmJiAoby5zZXJ2aWNlSXRlbUVsZW1lbnRQcm9wcyA9IHtcbiAgICAgICAgICAuLi5vLnNlcnZpY2VJdGVtRWxlbWVudFByb3BzLFxuICAgICAgICAgIHZlcnNpb25JbmZvczogblxuICAgICAgICB9KTtcbiAgICAgIHQgJiYgKHQudmVyc2lvbkxpc3RFbGVtZW50UHJvcHMgPSB7XG4gICAgICAgIC4uLnQudmVyc2lvbkxpc3RFbGVtZW50UHJvcHMsXG4gICAgICAgIGN1cnJlbnRWZXJzaW9uSWRlbnRpZmllcjogcy52ZXJzaW9uaW5nU3RhdGVMb29rdXAuZ2V0KGUpLmN1cnJlbnRWZXJzaW9uSW5mby52ZXJzaW9uSWRlbnRpZmllcixcbiAgICAgICAgdmVyc2lvbkluZm9zOiBuXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbiAgX3JlbW92ZVZlcnNpb25MaXN0Rmxvd0l0ZW0oZSkge1xuICAgIGZvciAoY29uc3QgaSBvZiBlLmNoaWxkTm9kZXMpXG4gICAgICBpLm5vZGVOYW1lLnRvVXBwZXJDYXNlKCkgPT09IFwiQVJDR0lTLVZFUlNJT04tTUFOQUdFTUVOVC1WRVJTSU9OLUxJU1RcIiAmJiAoZS5yZW1vdmVDaGlsZChpKSwgdGhpcy52ZXJzaW9uTGlzdCA9IHZvaWQgMCksIGkubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PT0gXCJDQUxDSVRFLUZMT1ctSVRFTVwiICYmIChpLmhpZGRlbiA9ICExKTtcbiAgfVxuICBfcmVtb3ZlVmVyc2lvblByb3BlcnRpZXNGbG93SXRlbShlKSB7XG4gICAgZm9yIChjb25zdCBpIG9mIGUuY2hpbGROb2RlcylcbiAgICAgIGkubm9kZU5hbWUudG9VcHBlckNhc2UoKSA9PT0gXCJBUkNHSVMtVkVSU0lPTi1NQU5BR0VNRU5ULVZFUlNJT04tUFJPUEVSVElFU1wiICYmIGUucmVtb3ZlQ2hpbGQoaSk7XG4gIH1cbiAgLy8jZW5kcmVnaW9uXG4gIC8vI3JlZ2lvbiBSZW5kZXJpbmdcbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgYWxsb3dFZGl0aW5nRGlzYWJsZWQ6IGUsIGNsb3NhYmxlOiBpLCBmbG93RWxlbWVudDogeyB2YWx1ZTogdCB9LCBpbml0aWFsVmVyc2lvbkluZm9zOiBzLCBfaXNJbml0aWFsVmVyc2lvbkludmFsaWQ6IG4sIGxhYmVsOiBsLCBtZXNzYWdlczogbywgbW9kZTogciwgcGFnZVNpemU6IGQsIHZlcnNpb25MaXN0OiB2LCB2aWV3TW9kZWw6IGEsIHZpZXdNb2RlbDogeyBsb2FkRXJyb3I6IGgsIHN0YXRlOiBtIH0gfSA9IHRoaXMsIEkgPSBBcnJheS5mcm9tKGEuc2VydmljZU5hbWVMb29rdXAsIChbYywgZl0pID0+ICh7IHVybDogYywgbmFtZTogZiB9KSksIFYgPSBtICE9PSBcImRpc2FibGVkXCIgPyBJLm1hcCgoYykgPT4ge1xuICAgICAgY29uc3QgZiA9IHtcbiAgICAgICAgYWxsb3dFZGl0aW5nOiAhZSxcbiAgICAgICAgY2xvc2FibGU6IGksXG4gICAgICAgIGN1cnJlbnRVc2VyOiBhLnVzZXJMb29rdXAuZ2V0KGMudXJsKSxcbiAgICAgICAgY3VycmVudFZlcnNpb25JZGVudGlmaWVyOiBhLnZlcnNpb25pbmdTdGF0ZUxvb2t1cC5nZXQoYy51cmwpLmN1cnJlbnRWZXJzaW9uSW5mby52ZXJzaW9uSWRlbnRpZmllcixcbiAgICAgICAgZXhlY3V0aW9uRXJyb3I6IHZvaWQgMCxcbiAgICAgICAgZmxvd0VsZW1lbnQ6IHQsXG4gICAgICAgIGhhc0FkdkVkaXRpbmdVdGU6IGEuYWR2YW5jZWRFZGl0aW5nVXNlclR5cGVFeHRlbnNpb25Mb29rdXAuZ2V0KGMudXJsKSxcbiAgICAgICAgaGVhZGluZzogbCxcbiAgICAgICAgaW5pdGlhbFZlcnNpb25JbmZvczogcyxcbiAgICAgICAgaXNJbml0aWFsVmVyc2lvbkludmFsaWQ6IG4sXG4gICAgICAgIGlzVmVyc2lvbkFkbWluaXN0cmF0b3I6IGEudmVyc2lvbkFkbWluaXN0cmF0b3JMb29rdXAuZ2V0KGMudXJsKSxcbiAgICAgICAgaXNWZXJzaW9uaW5nQXBpQXZhaWxhYmxlOiAoYS5zZXJ2ZXJWZXJzaW9uTG9va3VwLmdldChjLnVybCkgPz8gMCkgPj0gMTEuMixcbiAgICAgICAgbW9kZTogcixcbiAgICAgICAgcGFnZVNpemU6IGQsXG4gICAgICAgIHNlcnZpY2VOYW1lOiBjLm5hbWUsXG4gICAgICAgIHN0YXRlOiBtLFxuICAgICAgICBzZXJ2aWNlVXJsOiBjLnVybCxcbiAgICAgICAgc3RyaW5nczogbyxcbiAgICAgICAgdmVyc2lvbkluZm9zOiBhLnZlcnNpb25pbmdTdGF0ZUxvb2t1cC5nZXQoYy51cmwpPy52ZXJzaW9uSW5mb3MgPz8gW11cbiAgICAgIH07XG4gICAgICByZXR1cm4gZ2A8YXJjZ2lzLXZlcnNpb24tbWFuYWdlbWVudC1zZXJ2aWNlLWl0ZW0gLnNlcnZpY2VJdGVtRWxlbWVudFByb3BzPSR7Zn0gQGFyY2dpc0dldFZlcnNpb25zPSR7YXN5bmMgKHApID0+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5fcmVmcmVzaFZlcnNpb25MaXN0KHAuZGV0YWlsLnNlcnZpY2VVcmwpO1xuICAgICAgfX0gQGFyY2dpc0Zsb3dJdGVtQmFjaz0keygpID0+IHtcbiAgICAgICAgdCAmJiAodGhpcy5fcmVtb3ZlVmVyc2lvbkxpc3RGbG93SXRlbSh0KSwgdGhpcy52ZXJzaW9uTGlzdCA9IHZvaWQgMCk7XG4gICAgICB9fSBAYXJjZ2lzRmxvd0l0ZW1DbG9zZT0keygpID0+IHtcbiAgICAgICAgdGhpcy5faGFuZGxlRmxvd0l0ZW1DbG9zZSgpO1xuICAgICAgfX0gQGFyY2dpc01hbmFnZVZlcnNpb249JHt0aGlzLl9oYW5kbGVNYW5hZ2VWZXJzaW9uQWN0aW9ufSBAYXJjZ2lzTmV3VmVyc2lvbj0ke3RoaXMuX2hhbmRsZU5ld1ZlcnNpb25BY3Rpb259IEBhcmNnaXNDcmVhdGVWZXJzaW9uTGlzdD0keyhwKSA9PiB7XG4gICAgICAgIHRoaXMudmVyc2lvbkxpc3QgPSBwLmRldGFpbDtcbiAgICAgIH19PjwvYXJjZ2lzLXZlcnNpb24tbWFuYWdlbWVudC1zZXJ2aWNlLWl0ZW0+YDtcbiAgICB9KSA6IHZvaWQgMCwgRSA9IG0gPT09IFwiZGlzYWJsZWRcIiAmJiBoICE9IG51bGwgPyBnYDxjYWxjaXRlLW5vdGljZSBjbGFzcz1cIm5vdGljZVwiIGtpbmQ9d2FybmluZyBvcGVuIHNjYWxlPXMgc2xvdD1mb290ZXIgd2lkdGg9ZnVsbD48ZGl2IHNsb3Q9bWVzc2FnZT4ke3RoaXMuX2dldExvYWRFcnJvcihoKX08L2Rpdj48L2NhbGNpdGUtbm90aWNlPmAgOiB2b2lkIDAsIEwgPSB0aGlzLl9zaG93SW52YWxpZEZlYXR1cmVTZXJ2aWNlTm90aWNlID8gZ2A8Y2FsY2l0ZS1ub3RpY2UgY2xvc2FibGUga2luZD13YXJuaW5nIG9wZW4gc2NhbGU9cyBzbG90PWNvbnRlbnQtdG9wIHdpZHRoPWZ1bGwgaWNvbiBAY2FsY2l0ZU5vdGljZUNsb3NlPSR7KCkgPT4gdGhpcy5fc2hvd0ludmFsaWRGZWF0dXJlU2VydmljZU5vdGljZSA9ICExfT48ZGl2IHNsb3Q9dGl0bGU+JHtvLmhlYWRlcnMuaW52YWxpZEluaXRpYWxGZWF0dXJlU2VydmljZX08L2Rpdj48ZGl2IHNsb3Q9bWVzc2FnZT4ke28ubG9hZEVycm9ycy5pbnZhbGlkSW5pdGlhbEZlYXR1cmVTZXJ2aWNlfTwvZGl2PjwvY2FsY2l0ZS1ub3RpY2U+YCA6IHZvaWQgMDtcbiAgICByZXR1cm4gZ2A8Y2FsY2l0ZS1mbG93IGN1c3RvbS1pdGVtLXNlbGVjdG9ycz1cImFyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnQtdmVyc2lvbi1saXN0LCBhcmNnaXMtdmVyc2lvbi1tYW5hZ2VtZW50LXZlcnNpb24tcHJvcGVydGllc1wiIGNsYXNzPSR7Tih0aGlzLm1vZGUgPT09IFwiZGlhbG9nXCIgPyBcIlwiIDogXCJjYWxjaXRlLWZsb3ctd2lkZ2V0XCIpfSAke0ModGhpcy5mbG93RWxlbWVudCl9PjxjYWxjaXRlLWZsb3ctaXRlbSAuY2xvc2FibGU9JHt0aGlzLmNsb3NhYmxlfSAuaGVhZGluZz0ke2wgPz8gdm9pZCAwfSBAY2FsY2l0ZUZsb3dJdGVtQ2xvc2U9JHsoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVGbG93SXRlbUNsb3NlKCk7XG4gICAgfX0gLnNlbGVjdGVkPSR7IXZ9PiR7TH08Y2FsY2l0ZS1wYW5lbCAubG9hZGluZz0ke20gPT09IFwibG9hZGluZ1wiIHx8IG0gPT09IFwiZXhlY3V0aW5nXCJ9PiR7Vn0ke0V9PC9jYWxjaXRlLXBhbmVsPjwvY2FsY2l0ZS1mbG93LWl0ZW0+PC9jYWxjaXRlLWZsb3c+YDtcbiAgfVxufVxuUyhcImFyY2dpcy12ZXJzaW9uLW1hbmFnZW1lbnRcIiwgRCk7XG5leHBvcnQge1xuICBEIGFzIEFyY2dpc1ZlcnNpb25NYW5hZ2VtZW50XG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9